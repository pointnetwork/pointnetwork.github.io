<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.14">
<link rel="search" type="application/opensearchdescription+xml" title="Point Network" href="/opensearch.xml">
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Work+Sans:400,700&display=swap">
<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css">
<script src="https://unpkg.com/aos@next/dist/aos.js"></script>
<script src="../js/custom.js"></script><title data-react-helmet="true">Upgrade the Identity contract | Point Network</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://pointnetwork.github.io/docs/build-upgrade-identity-contract"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Upgrade the Identity contract | Point Network"><meta data-react-helmet="true" name="description" content="The Identity contract is at the heart of Point Network. Sometimes it needs to have some functionality added to it over time."><meta data-react-helmet="true" property="og:description" content="The Identity contract is at the heart of Point Network. Sometimes it needs to have some functionality added to it over time."><link data-react-helmet="true" rel="icon" href="/img/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://pointnetwork.github.io/docs/build-upgrade-identity-contract"><link data-react-helmet="true" rel="alternate" href="https://pointnetwork.github.io/docs/build-upgrade-identity-contract" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://pointnetwork.github.io/docs/build-upgrade-identity-contract" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.e6660aa5.css">
<link rel="preload" href="/assets/js/runtime~main.5791b824.js" as="script">
<link rel="preload" href="/assets/js/main.fc3f004c.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="http://pointnetwork.github.io/" target="_self" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/img/point-logo.svg" alt="Point Network" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/img/point-logo.svg" alt="Point Network" class="themedImage_TMUO themedImage--dark_uzRr"></div><b class="navbar__title">Point Network</b></a><a class="navbar__item navbar__link" href="/docs/getting-started">Getting Started</a><a class="navbar__item navbar__link" href="/docs/use-index">Use</a><a class="navbar__item navbar__link" href="/docs/learn-index">Learn</a><a class="navbar__item navbar__link" href="/docs/build-index">Build</a><a class="navbar__item navbar__link" href="/docs/maintain-index">Maintain</a><a class="navbar__item navbar__link" href="/api">API</a></div><div class="navbar__items navbar__items--right"><div class="searchBox_Utm0"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div><a class="navbar__item navbar__link" href="/docs/contributing">Contribute</a></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/getting-started">General</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/learn-index">Learn</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_TwRn" href="/docs/build-index">Build</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/build-index">Builder&#x27;s Portal</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_TwRn" tabindex="0" href="/docs/build-environments">Development Guide</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/build-environments">Point Network Environments</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/build-zapp-dev-environment-docker">Zapp Development Environment using Docker</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/build-zapp-dev-environment-direct-install">Zapp Development Environment (without Docker)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/build-create-a-dev-point-network-profile-in-firefox">Create a Dev Point Network Profile in Firefox</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/build-zapp-developer-guide">Point Network dapp Developers Guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/build-deploy-zapp">Deploy dApp to Point Network</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/build-upgradable-zapps">Point Network Upgradable Zapps</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/build-point-deploy-json-file-explained">Point Deploy Json File Explained</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/build-routes-json-file-explained">Point Routes Json File Explained</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/build-using-hardhat-console">Using Hardhat Console</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/build-file-upload-cli">File Upload using Point CLI</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/build-test-visitor-node-using-different-identity">Test Visitor Node with new Identity</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/build-import-data-from-live-dapps-into-dev">Import Data from Live dApps in to Dev</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/build-start-point-node-default">Start Point Node in YNet</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/build-delegating-deployer-identities">Delegating a dApp Deployer Identity</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/build-use-identity-oracle-in-devlocal">Using Identity Oracle in dev</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/build-upgrade-identity-contract">Upgrade the Identity contract</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/build-testing-guide">Testing Guide</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" tabindex="0" href="/docs/build-integration">Integration Guide</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/maintain-index">Maintain</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/use-index">Use</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/point_chain/about/overview">Point Chain</a></div></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Upgrade the Identity contract</h1></header><p>The Identity contract is at the heart of Point Network. Sometimes it needs to have some functionality added to it over time. </p><p>In this page we will outline how to upgrade the deployed Identity contract and how to interact with the Identity contract in a Hardhat console.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="overview">Overview<a class="hash-link" href="#overview" title="Direct link to heading">​</a></h3><p>To upgrade the Identity contract with a new version you need to perform the following steps:</p><ol><li>Ensure that the Identity contract owners seed phrase is currently saved in the <code>~/.point/keystore/key.json</code> file. This is automatically parsed in the <a href="https://github.com/pointnetwork/point-contracts/blob/main/hardhat.config.ts#L24" target="_blank" rel="noopener noreferrer">hardhat config</a> file when connecting to Ynet.</li><li>Compile the Identity contract</li><li>Run the Hardhat task to update the contract on a specific network (Ynet)</li><li>Commit the updated <code>unknown-10700.json</code> file to the <a href="https://github.com/pointnetwork/point-contracts/" target="_blank" rel="noopener noreferrer">point-contracts</a> repo so that it can be referenced for the next contract upgrade.</li><li>Update the Identity contract ABI file in Arweave</li><li>Copy the Areweave file hash and use that to update the <code>default.yaml</code> file in the Point Engine repo.</li></ol><h3 class="anchor anchorWithStickyNavbar_y2LR" id="technical-process">Technical Process<a class="hash-link" href="#technical-process" title="Direct link to heading">​</a></h3><ol><li><p>Ensure that the Identity contract owners seed phrase is currently saved in the <code>~/.point/keystore/key.json</code> file. </p><p>This step can be done by logging into Point Network via the Point Dashboard using the seed phrase of the Identity owner. </p><p>This is needed because <strong>only the owner</strong> of the Identity contract can upgrade it. </p></li><li><p>Compile the contract</p><p>Use Hardhat to compile the Identity contract like so:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">npx hardhat compile</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li><p>Run the Hardhat task to update the contract on a specific network</p><p>To update the Identity contract you can run the following command from the cloned <code>point-contracts</code> repo folder</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">npx hardhat identity-update-contract 0x1574E97F7a60c4eE518f6d7c0Fa701eff8Ab58b3 ./resources/unknown-10700.json --network ynet</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Details are in the <code>identity-update-contract</code> task source code <a href="https://github.com/pointnetwork/point-contracts/blob/main/tasks/identity/identity-update-contract.ts" target="_blank" rel="noopener noreferrer">here</a>.</p></li><li><p>Commit the updated <code>unknown-10700.json</code> file to the point-contracts repo</p><p>Commit <code>unknown-10700.json</code> file after running the command to store proxy metadata for further deployments.</p></li><li><p>Update the Identity contract ABI file in Arweave</p><p>This has to be done using the <code>point</code> cli and so you will need to cd into the Point Engine repo first.</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">cd pointnetwork</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">./point upload ../point-contracts/build/contracts/Identity.sol/Identity.json</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li><p>Copy the Areweave file hash and use that to update the <code>default.yml</code> file in the Point Engine repo.</p><p>The returned Arweave file hash for the Identity contract ABI needs to be set in the <code>identity_contract_id</code> key of the <a href="https://github.com/pointnetwork/pointnetwork/blob/develop/config/default.yaml#L3" target="_blank" rel="noopener noreferrer">default.yaml</a> file in the Point Engine repo.</p></li></ol><p><strong>Make sure to remember to commit all the code changes back to Github and to check the deployment of the contract.</strong></p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="troubleshooting">Troubleshooting<a class="hash-link" href="#troubleshooting" title="Direct link to heading">​</a></h3><p>During deployment you may experience some issues. Check below to see if any of the following help you:</p><ul><li><p><strong>Error: Timed out waiting for implementation contract deployment to address cannot estimate gas; transaction may fail or may require manual gas limit UNPREDICTABLE_GAS_LIMIT</strong></p><p>  The error indicates that the transaction is not mined by the blockchain with the default gas values. </p><p>  Try this workaround to <a href="https://github.com/OpenZeppelin/openzeppelin-upgrades/issues/85" target="_blank" rel="noopener noreferrer">Override transaction options</a> (<code>from</code>, <code>gas</code>, <code>gasPrice</code>) in create and upgrade proxy.</p></li><li><p><strong>Deploy from another account or machine</strong>. </p><p>  One workaround is to deploy from another account. Seems to have some cache related problem that makes the upgrade work from some accounts and not from others. The <code>.openzeppelin</code> folder also contains metadata from the deployment, some other problems were solved by deleting this file. </p><p>  The file can be recovered from blockchain using <code>forceImport</code> as we do <a href="https://github.com/pointnetwork/pointnetwork/blob/9e2c8230c9c6e861af54a98493d88d460bc96f81/src/client/zweb/deployer/index.js#L344" target="_blank" rel="noopener noreferrer">here</a>. </p></li><li><p><strong>Contract size to large to deploy</strong></p><p>  If the contract size seems to be a problem, you can try to use the optimizer to reduce that. It is already enabled by default in the hardhat config of Point Engine.
</p></li><li><p><strong>Test locally using Geth instead of Ganache</strong>. </p><p>  This is just an option to confirm if this problem only occurs with YNet since YNet is a geth node any code problem should happen in a local env using Geth. We have a <a href="https://github.com/pointnetwork/pointnetwork/blob/develop/docker-compose.e2e-geth.yaml" target="_blank" rel="noopener noreferrer">docker compose file</a> that starts as a local blockchain node for testing that.</p></li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="interact-with-identity-contract-in-hardhat-console">Interact with Identity Contract in Hardhat Console<a class="hash-link" href="#interact-with-identity-contract-in-hardhat-console" title="Direct link to heading">​</a></h3><p>Firstly make sure you are in the point-contracts repo and then start hardhat console like so:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">cd point-contracts</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">npx hardhat console --network ynet</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Now in the Hardhat console you can load the Identity contract and start to call functions. </p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">// Load Identity Contract instance</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">id = await hre.ethers.getContractAt(&quot;Identity&quot;, &quot;0x1574E97F7a60c4eE518f6d7c0Fa701eff8Ab58b3&quot;);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// Check the owner of the Identity contract </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">await id.owner()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// Check dev mode setting</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">await id.getDevMode()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// Fetch IKV values from the contract, e.g.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">await id.ikvGet(&#x27;social&#x27;, &#x27;zweb/contracts/address/PointSocial&#x27;)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="steps-to-migrate-data-to-a-new-identity-contract-instance">Steps to migrate data to a new Identity contract instance<a class="hash-link" href="#steps-to-migrate-data-to-a-new-identity-contract-instance" title="Direct link to heading">​</a></h3><p>If you experience issues with the upgrade process then you can also redeploy a brand new instance of the Identity contract. However, if you do so, you will need to migrate all the data across from the current Indentity instance to the new Identity instance.</p><p>The steps to perform the Identity contract deployment and data migration are as follows:</p><ol><li><p>Switch to <code>main</code> branch in Point Contracts repo and compile the Identity contract using</p><p> <code>npx hardhat compile</code></p></li><li><p>Download the data from the existing Identity contract using </p><p><code>npx hardhat identity-importer download 0x1574E97F7a60c4eE518f6d7c0Fa701eff8Ab58b3 --network ynet</code></p><p>By default this script will download all registered Identities from block 0 to the last block at the time the script starts. Note that this script may take a long time to run and may even timeout. If you experience timeouts, then you should find a range of blocks that works using the <code>--from-block</code> and <code>--to-block</code> parameters.</p></li><li><p>Switch to the branch that contains the latest version of the Identity contract you want to deploy</p></li><li><p>Compile and deploy a <strong>new</strong> instance of the Identity contract from that branch to YNet using </p><p><code>npx hardhat run scripts/deploy.ts --network ynet</code></p></li><li><p>From the Point Engine repo upload the updated Identity ABI using </p><p><code>./point upload ../point-contracts/build/contracts/Identity.sol/Identity.json</code></p></li><li><p>Update <code>default.yaml</code> in Point Engine repo and set <code>identity_contract_id</code> to the Identity ABI hash returned in the previous call. </p></li><li><p>Update <code>default.yaml</code> in Point Engine and set <code>identity_contract_address</code> to the new Identity contract address just deployed.</p></li><li><p>Upload the Identity data to the new Identity contract instance using the following script (once for each migration file you pass to it and replace NEW_ADDRESS &amp; RANGE accordingly):</p><p><code>npx hardhat identity-importer upload NEW_ADDRESS --migration-file ./resources/identity-BLOCK_RANGE.json  --network ynet</code></p></li><li><p>Upload the ikv versions using the ikversion-importer migration script (once for each migration file you pass to it).</p><p><code>npx hardhat ikversion-importer 0x8E34Fc67034b8A593E87d5f2644D098A3dBd2Fe7 --migration-file ./resources/identity-BLOCK_RANGE.json --network ynet</code></p></li><li><p>Upload the registered dapps data using the dapps-importer migration script (once for each migration file you pass to it).</p><p><code>npx hardhat dapps-importer 0x8E34Fc67034b8A593E87d5f2644D098A3dBd2Fe7 --migration-file ./resources/identity-BLOCK_RANGE.json --network ynet</code></p></li><li><p>Manually migrate each subidentity by calling the <code>subidentitiesListImport</code> function on the Identity contract using Hardhat console.</p><p><code>subidentitiesListImport(address owner, string memory subidentity)</code></p></li><li><p>Verify the Identities, Sub Identities IKVs, IKV versions, dApps data have been migrated correctly to the new contract using Hardhat console</p></li><li><p>Merge these changes (the updated Identity contract, updated default.yaml etc)</p></li></ol></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/pointnetwork/pointnetwork.github.io/edit/main/website/docs/build/build-upgrade-identity-contract.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_mt2f"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2022-09-16T09:51:31.000Z">9/16/2022</time></b> by <b>Darren Jensen</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/build-use-identity-oracle-in-devlocal"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Using Identity Oracle in dev</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/build-testing-guide"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Testing Guide</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#technical-process" class="table-of-contents__link toc-highlight">Technical Process</a></li><li><a href="#troubleshooting" class="table-of-contents__link toc-highlight">Troubleshooting</a></li><li><a href="#interact-with-identity-contract-in-hardhat-console" class="table-of-contents__link toc-highlight">Interact with Identity Contract in Hardhat Console</a></li><li><a href="#steps-to-migrate-data-to-a-new-identity-contract-instance" class="table-of-contents__link toc-highlight">Steps to migrate data to a new Identity contract instance</a></li></ul></div></div></div></div></main></div></div><footer class="nav-footer spacer-y-4 pb-4" id="footer"><div class="container"><div class="justify-content-start row"><div class="mb-3 mb-md-0 col-md-3 col-6"><h5 class="text-white">General</h5><ul class="list-unstyled"><li class="py-0 py-md-1"><a href="https://pointnetwork.io/about" class="text-white" target="_blank" rel="noopener noreferrer">About</a></li><li class="py-0 py-md-1"><a href="https://pointnetwork.io/#frequently-asked-questions" class="text-white" target="_blank" rel="noopener noreferrer">FAQ</a></li><li class="py-0 py-md-1"><a href="https://pointnetwork.io/support" class="text-white" target="_blank" rel="noopener noreferrer">Support</a></li><li class="py-0 py-md-1"><a href="mailto:info@pointnetwork.io" class="text-white" target="_blank" rel="noopener noreferrer">Contact</a></li><li class="py-0 py-md-1"><a href="/docs/build-index" class="text-white" target="_blank" rel="noopener noreferrer">Build</a></li><li class="py-0 py-md-1"><a href="https://pointnetwork-1639566514062.freshteam.com/jobs" class="text-white" target="_blank" rel="noopener noreferrer">Careers</a></li></ul></div><div class="mb-3 mb-md-0 col-md-3 col-6"><h5 class="text-white">Technology</h5><ul class="list-unstyled"><li class="py-0 py-md-1"><a href="https://pointnetwork.io/" class="text-white" target="_blank" rel="noopener noreferrer">Technology</a></li><li class="py-0 py-md-1"><a href="/docs/point-token" class="text-white" target="_blank" rel="noopener noreferrer">Token</a></li><li class="py-0 py-md-1"><a href="https://pointnetwork.io/link/whitepaper" class="text-white" target="_blank" rel="noopener noreferrer">Whitepaper</a></li><li class="py-0 py-md-1"><a href="https://pointnetwork.io/link/litepaper" class="text-white" target="_blank" rel="noopener noreferrer">Lightpaper</a></li></ul></div><div class="mb-3 mb-md-0 col-md-3 col-6"><h5 class="text-white">Community</h5><ul class="list-unstyled"><li class="py-0 py-md-1"><a href="https://pointnetwork.io/page/social" class="text-white" target="_blank" rel="noopener noreferrer">Community</a></li><li class="py-0 py-md-1"><a href="https://pointnetwork.github.io/docs/getting-started" class="text-white" target="_blank" rel="noopener noreferrer">Documentation</a></li><li class="py-0 py-md-1"><a href="https://medium.com/@Pointnetwork" class="text-white" target="_blank" rel="noopener noreferrer">Blog</a></li><li class="py-0 py-md-1"><a href="https://t.me/pointnetworkchat" class="text-white" target="_blank" rel="noopener noreferrer">Telegram Chat</a></li></ul></div><div class="px-lg-0 col-md-3"><ul class="list-social-links justify-content-around"><li class="text-white"><a href="https://twitter.com/pointnetwork" target="_blank" rel="noopener noreferrer"><i class="socicon-twitter"></i></a></li><li class="text-white"><a href="https://www.reddit.com/r/pointnetwork/" target="_blank" rel="noopener noreferrer"><i class="socicon-reddit"></i></a></li><li class="text-white"><a href="https://github.com/pointnetwork" target="_blank" rel="noopener noreferrer"><i class="socicon-github"></i></a></li><li class="text-white"><a href="https://www.youtube.com/channel/UCWZkr5qbQhmMtD4Zt374-FA" target="_blank" rel="noopener noreferrer"><i class="socicon-youtube"></i></a></li><li class="text-white"><a href="https://t.me/pointnetworkchat" target="_blank" rel="noopener noreferrer"><i class="socicon-telegram"></i></a></li></ul><p class="d-block text-white">Subscribe to the newsletter to hear about Point Network updates and events.</p><button type="button" class="btn btn-primary"><a href="https://pointnetwork.io/#subscribe" target="_blank" style="color:white">Subscribe</a></button></div></div><div class="footer-legal align-items-end mt-5 pt-4 row"><div class="mb-2 mb-lg-0 col-lg-2"><a class="navbar-brand" href="https://pointnetwork.io" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 677.7 679" style="enable-background:new 0 0 677.7 679" xml:space="preserve" class="brand"><title>Point Network Logo</title><path fill="#fff" d="M338.9-.2C151.8-.2.1 151.8.1 339.3c0 187.6 151.7 339.6 338.8 339.6s338.8-152 338.8-339.6C677.7 151.8 526-.2 338.9-.2zm0 636.3c-163.5 0-296-132.9-296-296.7s132.6-296.7 296-296.7 296 132.8 296 296.7-132.5 296.7-296 296.7z"></path><path fill="#fff" d="M203.1 314.9h-18.6v22.5h18.6v-.1c1.9 0 3.7-.5 5.2-1.5 1.6-1.1 2.8-2.4 3.7-4.1 1-1.7 1.5-3.6 1.5-5.7 0-3.1-1-5.8-3.1-7.9-2.1-2.1-4.5-3.2-7.3-3.2zM290.8 317.4c-3.7-2.3-7.9-3.4-12.8-3.4s-9.2 1.1-13 3.4c-3.7 2.2-6.6 5.3-8.7 9.1-2.1 3.8-3.1 8.2-3.1 13 0 4.9 1 9.3 3.1 13.1 2.1 3.8 5 6.9 8.7 9.1 3.8 2.2 8.1 3.3 13 3.3 4.8 0 9.1-1.1 12.8-3.3 3.8-2.3 6.7-5.4 8.8-9.2 2.1-3.8 3.2-8.2 3.2-13 0-4.9-1.1-9.2-3.2-13-2.1-3.9-5.1-6.9-8.8-9.1z"></path><path fill="#fff" d="M337.1 97.4c-132.4 0-239.7 107.5-239.7 240.1 0 132.7 107.3 240.3 239.7 240.3s239.7-107.6 239.7-240.2c0-132.7-107.3-240.2-239.7-240.2zM222.3 336.9c-2 3.3-4.6 5.9-8 7.8-3.3 1.9-7 2.9-11 2.9h-18.8v26.9H173v-70.2h30.3v.1c4 0 7.6 1 11 2.9 3.3 1.9 6 4.4 8 7.7 2 3.2 3 6.9 3 10.9s-1 7.7-3 11zm89.5 16.8c-1.8 4.3-4.3 8.2-7.7 11.4-3.3 3.3-7.1 5.9-11.6 7.7-4.4 1.8-9.3 2.7-14.6 2.7-5.3 0-10.2-.9-14.7-2.7-4.5-1.9-8.3-4.4-11.6-7.7-3.3-3.3-5.8-7.1-7.6-11.4-1.8-4.4-2.7-9.2-2.7-14.2s.9-9.8 2.7-14.1c1.8-4.4 4.3-8.3 7.6-11.5 3.3-3.3 7.1-5.8 11.6-7.6 4.5-1.9 9.4-2.8 14.7-2.8 5.3 0 10.2.9 14.6 2.8 4.5 1.8 8.3 4.3 11.6 7.6 3.3 3.3 5.9 7.1 7.7 11.5 1.8 4.3 2.7 9 2.7 14.1s-.9 9.8-2.7 14.2zm32.8-39.3v60.2h-11.4v-70.2h11.4v10zm82.9 60.2H417l-41.5-51.3v51.3H364v-70.2h10.3l41.9 52.9V339c-.1-4-.2-7.9-.2-11.5v-23.1h11.5v70.2zm70.1-59.8h-21.5v59.8h-11.5v-59.8h-20.8v-10.4h53.8v10.4z"></path></svg></a></div><div class="col-lg-10"><ul class="list-unstyled d-flex flex-wrap list-pipe-separator"><li><a href="https://pointnetwork.io" class="text-white text-small" target="_blank" rel="noopener noreferrer">Copyright © 2022 Point Network Limited</a></li><li><a href="https://t.me/pointnetworkchat" class="text-white text-small" target="_blank" rel="noopener noreferrer">Telegram</a></li><li><a href="https://pointnetwork.io/pages/terms" class="text-white text-small" target="_blank" rel="noopener noreferrer">Terms</a></li><li><a href="https://pointnetwork.io/pages/privacy" class="text-white text-small" target="_blank" rel="noopener noreferrer">Privacy</a></li></ul></div></div></div></footer></div>
<script src="/assets/js/runtime~main.5791b824.js"></script>
<script src="/assets/js/main.fc3f004c.js"></script>
</body>
</html>