"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[4083],{3905:function(e,t,n){n.d(t,{Zo:function(){return l},kt:function(){return h}});var r=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var c=r.createContext({}),p=function(e){var t=r.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},l=function(e){var t=p(e.components);return r.createElement(c.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},u=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,c=e.parentName,l=s(e,["components","mdxType","originalType","parentName"]),u=p(n),h=a,m=u["".concat(c,".").concat(h)]||u[h]||d[h]||o;return n?r.createElement(m,i(i({ref:t},l),{},{components:n})):r.createElement(m,i({ref:t},l))}));function h(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,i=new Array(o);i[0]=u;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s.mdxType="string"==typeof e?e:a,i[1]=s;for(var p=2;p<o;p++)i[p]=n[p];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}u.displayName="MDXCreateElement"},86379:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return s},contentTitle:function(){return c},metadata:function(){return p},toc:function(){return l},default:function(){return u}});var r=n(83117),a=n(80102),o=(n(67294),n(3905)),i=["components"],s={},c=void 0,p={unversionedId:"point_chain/developers/json-rpc/events",id:"point_chain/developers/json-rpc/events",title:"events",description:"\x3c!--",source:"@site/docs/point_chain/developers/json-rpc/events.md",sourceDirName:"point_chain/developers/json-rpc",slug:"/point_chain/developers/json-rpc/events",permalink:"/docs/point_chain/developers/json-rpc/events",editUrl:"https://github.com/pointnetwork/pointnetwork.github.io/edit/main/website/docs/point_chain/developers/json-rpc/events.md",tags:[],version:"current",lastUpdatedBy:"Darren Jensen",lastUpdatedAt:1664880246,formattedLastUpdatedAt:"10/4/2022",frontMatter:{}},l=[{value:"Pre-requisite Readings",id:"pre-requisite-readings",children:[],level:2},{value:"Subscribing to Events",id:"subscribing-to-events",children:[{value:"Cosmos and Tendermint Events",id:"cosmos-and-tendermint-events",children:[],level:3},{value:"Ethereum Events",id:"ethereum-events",children:[],level:3}],level:2},{value:"Websocket Connection",id:"websocket-connection",children:[{value:"Tendermint Websocket",id:"tendermint-websocket",children:[],level:3},{value:"Ethereum Websocket",id:"ethereum-websocket",children:[],level:3}],level:2}],d={toc:l};function u(e){var t=e.components,n=(0,a.Z)(e,i);return(0,o.kt)("wrapper",(0,r.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"events"},"Events"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"Event"),"s are objects that contain information about the execution of the application. They are\nmainly used by service providers like block explorers and wallet to track the execution of various\nmessages and index transactions."),(0,o.kt)("h2",{id:"pre-requisite-readings"},"Pre-requisite Readings"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://docs.cosmos.network/main/core/events.html"},"Cosmos SDK Events")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://geth.ethereum.org/docs/rpc/pubsub"},"Ethereum's PubSub JSON-RPC API"))),(0,o.kt)("h2",{id:"subscribing-to-events"},"Subscribing to Events"),(0,o.kt)("h3",{id:"cosmos-and-tendermint-events"},"Cosmos and Tendermint Events"),(0,o.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"Check the ",(0,o.kt)("a",{parentName:"p",href:"/docs/point_chain/developers/clients#tendermint-websocket"},"Tendermint Websocket")," in the Clients documentation for reference."))),(0,o.kt)("p",null,"It is possible to subscribe to ",(0,o.kt)("inlineCode",{parentName:"p"},"Events")," via Tendermint's ",(0,o.kt)("a",{parentName:"p",href:"https://docs.tendermint.com/v0.34/tendermint-core/subscription.html"},"Websocket"),".\nThis is done by calling the ",(0,o.kt)("inlineCode",{parentName:"p"},"subscribe")," RPC method via Websocket:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "jsonrpc": "2.0",\n    "method": "subscribe",\n    "id": "0",\n    "params": {\n        "query": "tm.event=\'<event_value>\' AND eventType.eventAttribute=\'<attribute_value>\'"\n    }\n}\n')),(0,o.kt)("p",null,"These events are triggered after a block is committed. You can get the full list of ",(0,o.kt)("inlineCode",{parentName:"p"},"event")," categories and values ",(0,o.kt)("a",{parentName:"p",href:"/docs/point_chain/developers/clients#list-of-tendermint-events"},"here"),"."),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"type")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"attribute")," value of the ",(0,o.kt)("inlineCode",{parentName:"p"},"query")," allow you to filter the specific ",(0,o.kt)("inlineCode",{parentName:"p"},"event")," you are\nlooking for. For example, a an Ethereum transaction on Point Chain (",(0,o.kt)("inlineCode",{parentName:"p"},"MsgEthereumTx"),") triggers an ",(0,o.kt)("inlineCode",{parentName:"p"},"event")," of type ",(0,o.kt)("inlineCode",{parentName:"p"},"ethermint")," and\nhas ",(0,o.kt)("inlineCode",{parentName:"p"},"sender")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"recipient")," as ",(0,o.kt)("inlineCode",{parentName:"p"},"attributes"),". Subscribing to this ",(0,o.kt)("inlineCode",{parentName:"p"},"event")," would be done like so:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "jsonrpc": "2.0",\n    "method": "subscribe",\n    "id": "0",\n    "params": {\n        "query": "tm.event=\'Tx\' AND ethereum.recipient=\'hexAddress\'"\n    }\n}\n')),(0,o.kt)("p",null,"where ",(0,o.kt)("inlineCode",{parentName:"p"},"hexAddress")," is an Ethereum hex address (eg: ",(0,o.kt)("inlineCode",{parentName:"p"},"0x1122334455667788990011223344556677889900"),")."),(0,o.kt)("h3",{id:"ethereum-events"},"Ethereum Events"),(0,o.kt)("p",null,"Point Chain also supports the Ethereum ",(0,o.kt)("a",{parentName:"p",href:"/docs/point_chain/developers/json-rpc/server"},"JSON-RPC")," filters calls to\nsubscribe to ",(0,o.kt)("a",{parentName:"p",href:"https://eth.wiki/json-rpc/API#eth_newfilter"},"state logs"),",\n",(0,o.kt)("a",{parentName:"p",href:"https://eth.wiki/json-rpc/API#eth_newblockfilter"},"blocks")," or ",(0,o.kt)("a",{parentName:"p",href:"https://eth.wiki/json-rpc/API#eth_newpendingtransactionfilter"},"pending transactions")," changes."),(0,o.kt)("p",null,"Under the hood, it uses the Tendermint RPC client's event system to process subscriptions that are\nthen formatted to Ethereum-compatible events."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},'curl -X POST --data \'{"jsonrpc":"2.0","method":"eth_newBlockFilter","params":[],"id":1}\' -H "Content-Type: application/json" http://localhost:8545\n\n{"jsonrpc":"2.0","id":1,"result":"0x3503de5f0c766c68f78a03a3b05036a5"}\n')),(0,o.kt)("p",null,"Then you can check if the state changes with the ",(0,o.kt)("a",{parentName:"p",href:"https://eth.wiki/json-rpc/API#eth_getfilterchanges"},(0,o.kt)("inlineCode",{parentName:"a"},"eth_getFilterChanges"))," call:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},'curl -X POST --data \'{"jsonrpc":"2.0","method":"eth_getFilterChanges","params":["0x3503de5f0c766c68f78a03a3b05036a5"],"id":1}\' -H "Content-Type: application/json" http://localhost:8545\n\n{"jsonrpc":"2.0","id":1,"result":["0x7d44dceff05d5963b5bc81df7e9f79b27e777b0a03a6feca09f3447b99c6fa71","0x3961e4050c27ce0145d375255b3cb829a5b4e795ac475c05a219b3733723d376","0xd7a497f95167d63e6feca70f344d9f6e843d097b62729b8f43bdcd5febf142ab","0x55d80a4ba6ef54f2a8c0b99589d017b810ed13a1fda6a111e1b87725bc8ceb0e","0x9e8b92c17280dd05f2562af6eea3285181c562ebf41fc758527d4c30364bcbc4","0x7353a4b9d6b35c9eafeccaf9722dd293c46ae2ffd4093b2367165c3620a0c7c9","0x026d91bda61c8789c59632c349b38fd7e7557e6b598b94879654a644cfa75f30","0x73e3245d4ddc3bba48fa67633f9993c6e11728a36401fa1206437f8be94ef1d3"]}\n')),(0,o.kt)("h2",{id:"websocket-connection"},"Websocket Connection"),(0,o.kt)("h3",{id:"tendermint-websocket"},"Tendermint Websocket"),(0,o.kt)("p",null,"To start a connection with the Tendermint websocket you need to define the address with the ",(0,o.kt)("inlineCode",{parentName:"p"},"--rpc.laddr"),"\nflag when starting the node (default ",(0,o.kt)("inlineCode",{parentName:"p"},"tcp://127.0.0.1:26657"),"):"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},'pointd start --rpc.laddr="tcp://127.0.0.1:26657"\n')),(0,o.kt)("p",null,"Then, start a websocket subscription with ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/hashrocket/ws"},"ws")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},'# connect to tendermint websocket at port 8080 as defined above\nws ws://localhost:8080/websocket\n\n# subscribe to new Tendermint block headers\n> { "jsonrpc": "2.0", "method": "subscribe", "params": ["tm.event=\'NewBlockHeader\'"], "id": 1 }\n')),(0,o.kt)("h3",{id:"ethereum-websocket"},"Ethereum Websocket"),(0,o.kt)("p",null,"Since Point Chain runs uses Tendermint Core as it's consensus Engine and it's built with the Cosmos\nSDK framework, it inherits the event format from them. However, in order to support the native Web3\ncompatibility for websockets of the ",(0,o.kt)("a",{parentName:"p",href:"https://geth.ethereum.org/docs/rpc/pubsub"},"Ethereum's PubSubAPI"),", Point Chain needs to cast the Tendermint\nresponses retrieved into the Ethereum types."),(0,o.kt)("p",null,"You can start a connection with the Ethereum websocket using the ",(0,o.kt)("inlineCode",{parentName:"p"},"--json-rpc.ws-address")," flag when starting\nthe node (default ",(0,o.kt)("inlineCode",{parentName:"p"},'"0.0.0.0:8546"'),"):"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},'pointd start  --json-rpc.address"0.0.0.0:8545" --json-rpc.ws-address="0.0.0.0:8546" --evm.rpc.api="eth,web3,net,txpool,debug" --json-rpc.enable\n')),(0,o.kt)("p",null,"Then, start a websocket subscription with ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/hashrocket/ws"},(0,o.kt)("inlineCode",{parentName:"a"},"ws"))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},'# connect to tendermint websocet at port 8546 as defined above\nws ws://localhost:8546/\n\n# subscribe to new Ethereum-formatted block Headers\n> {"id": 1, "method": "eth_subscribe", "params": ["newHeads", {}]}\n< {"jsonrpc":"2.0","result":"0x44e010cb2c3161e9c02207ff172166ef","id":1}\n')))}u.isMDXComponent=!0}}]);